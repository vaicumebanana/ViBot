<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ViBot - Assistente Virtual</title>
  <style>
    :root {
      --primary: #4f46e5;
      --user-bg: #4f46e5;
      --bot-bg: #f3f4f6;
      --error-bg: #fee2e2;
      --text: #111827;
      --error-text: #dc2626;
    }
    body {
      font-family: 'Inter', sans-serif;
      background: #f9fafb;
      margin: 0;
      padding: 0;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 32px;
      background: white;
      border-bottom: 1px solid #e5e7eb;
    }
    h1 { margin: 0; color: var(--primary); }
    #languageSelector {
      padding: 8px;
      border-radius: 8px;
      border: 1px solid #d1d5db;
    }
    main {
      display: flex;
      max-width: 1100px;
      margin: 20px auto;
      gap: 20px;
      padding: 0 20px;
    }
    #chat-container { flex: 1; display: flex; flex-direction: column; }
    #chatbox {
      background: white;
      border: 1px solid #e5e7eb;
      border-radius: 12px;
      flex: 1;
      padding: 16px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    .message {
      padding: 12px 16px;
      border-radius: 12px;
      max-width: 85%;
      line-height: 1.5;
      animation: fadeIn 0.3s ease-out;
      word-wrap: break-word;
      white-space: pre-wrap;
    }
    .user { background: var(--user-bg); color: white; align-self: flex-end; border-bottom-right-radius: 4px; }
    .bot  { background: var(--bot-bg);  color: var(--text); align-self: flex-start; border-bottom-left-radius: 4px; }
    .error{ background: var(--error-bg); color: var(--error-text); align-self: center; text-align: center; }
    .typing {
      color: #6b7280;
      font-style: italic;
      animation: blink 1s steps(1) infinite;
    }
    @keyframes fadeIn { from {opacity:0;transform:translateY(10px);} to {opacity:1;transform:translateY(0);} }
    @keyframes blink { 50%{opacity:0.5;} }
    #input-container { display: flex; gap: 12px; margin-top: 12px; }
    #userInput {
      flex: 1;
      padding: 12px 16px;
      border: 1px solid #e5e7eb;
      border-radius: 12px;
      font-size: 16px;
    }
    #sendBtn {
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 12px;
      padding: 0 24px;
      font-weight: 500;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    #sendBtn:hover:not(:disabled) { background: #4338ca; }
    #sendBtn:disabled { background: #9ca3af; cursor: not-allowed; }
    aside {
      width: 250px;
      background: white;
      border: 1px solid #e5e7eb;
      border-radius: 12px;
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    #newConversationBtn {
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 12px;
      padding: 12px;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    #newConversationBtn:hover { background: #4338ca; }
    #conversationList {
      overflow-y: auto;
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .conversation-btn {
      background: #f3f4f6;
      border: none;
      border-radius: 8px;
      padding: 8px 12px;
      font-size: 14px;
      color: var(--text);
      text-align: left;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    .conversation-btn:hover { background: var(--primary); color: white; }
    .conversation-btn.active { background: var(--primary); color: white; font-weight: 700; }
    @media(max-width:768px) {
      main { flex-direction: column; }
      aside { width:100%; margin-bottom:20px; order:-1; }
      #chatbox { height:50vh; }
      #input-container { flex-direction:column; }
      #sendBtn { width:100%; }
    }
  </style>
</head>
<body>
  <header>
    <h1>ViBot</h1>
    <select id="languageSelector">
      <option value="pt" selected>Portugu√™s</option>
      <option value="en">English</option>
      <option value="es">Espa√±ol</option>
      <option value="zh">‰∏≠Êñá</option>
      <option value="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option>
      <option value="ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
      <option value="fr">Fran√ßais</option>
      <option value="ru">–†—É—Å—Å–∫–∏–π</option>
    </select>
  </header>

  <main>
    <div id="chat-container">
      <div id="chatbox" role="log" aria-live="polite"></div>
      <div id="input-container">
        <input id="userInput" placeholder="Digite sua mensagem..." />
        <button id="sendBtn">üì© Enviar</button>
      </div>
    </div>
    <aside>
      <button id="newConversationBtn">‚ûï Nova Conversa</button>
      <div id="conversationList"></div>
    </aside>
  </main>

  <script>
    const ViBot = {
      config: {
        apiUrl: "https://api.groq.com/openai/v1/chat/completions",
        apiKey: "SUA_API_KEY_AQUI",
        model: "llama3-70b-8192",
        temperature: 0.7,
        maxTokens: 1024
      },
      DOM: {}, currentConversationId: null, conversations: {},
      init() {
        const ids = ["chatbox","userInput","sendBtn","newConversationBtn","conversationList","languageSelector"];
        ids.forEach(id => this.DOM[id] = document.getElementById(id));
        this.DOM.typingIndicator = Object.assign(document.createElement("div"), {
          className: "message bot typing",
          textContent: "ViBot est√° digitando..."
        });
        this.loadConversations();
        if (!this.currentConversationId) this.createNewConversation();
        else { this.renderConversationsList(); this.renderCurrentConversation(); }
        this.DOM.sendBtn.addEventListener("click", () => this.sendMessage());
        this.DOM.userInput.addEventListener("keydown", e => {
          if (e.key === "Enter") { e.preventDefault(); this.sendMessage(); }
        });
        this.DOM.newConversationBtn.addEventListener("click", () => this.createNewConversation());
      },
      createNewConversation() {
        const id = "conv_" + Date.now();
        this.conversations[id] = [];
        this.currentConversationId = id;
        this.saveConversations();
        this.renderConversationsList();
        this.renderCurrentConversation();
        this.DOM.userInput.focus();
      },
      saveConversations() {
        localStorage.setItem("vibot_conversations", JSON.stringify(this.conversations));
        localStorage.setItem("vibot_current", this.currentConversationId);
      },
      loadConversations() {
        const conv = localStorage.getItem("vibot_conversations");
        if (conv) {
          this.conversations = JSON.parse(conv);
          this.currentConversationId = localStorage.getItem("vibot_current") || Object.keys(this.conversations)[0];
        }
      },
      renderConversationsList() {
        this.DOM.conversationList.innerHTML = "";
        Object.keys(this.conversations).reverse().forEach(id => {
          const btn = document.createElement("button");
          btn.className = "conversation-btn" + (id === this.currentConversationId ? " active" : "");
          btn.textContent = this.getConversationTitle(this.conversations[id]) || "Nova Conversa";
          btn.onclick = () => { this.currentConversationId = id; this.saveConversations(); this.renderConversationsList(); this.renderCurrentConversation(); };
          this.DOM.conversationList.appendChild(btn);
        });
      },
      getConversationTitle(messages) {
        const first = messages.find(m => m.role === "user");
        return first ? (first.content.length > 20 ? first.content.slice(0, 20) + "..." : first.content) : "";
      },
      renderCurrentConversation() {
        this.DOM.chatbox.innerHTML = "";
        this.conversations[this.currentConversationId].forEach(msg => this.addMessage(msg.content, msg.role));
      },
      addMessage(text, role) {
        const d = document.createElement("div");
        d.className = "message " + (["user","bot","error"].includes(role) ? role : "bot");
        d.textContent = text;
        this.DOM.chatbox.appendChild(d);
        this.DOM.chatbox.scrollTop = this.DOM.chatbox.scrollHeight;
      },
      async sendMessage() {
        const prompt = this.DOM.userInput.value.trim();
        if (!prompt) return;
        this.DOM.sendBtn.disabled = true;
        // user message
        this.addMessage(prompt, "user");
        this.conversations[this.currentConversationId].push({ role: "user", content: prompt });
        this.saveConversations();
        this.DOM.chatbox.appendChild(this.DOM.typingIndicator);
        this.DOM.chatbox.scrollTop = this.DOM.chatbox.scrollHeight;
        try {
          const lang = this.DOM.languageSelector.value;
          const messages = [{ role: "system", content: this.getSystemPrompt(lang) }, ...this.conversations[this.currentConversationId]];
          const res = await fetch(this.config.apiUrl, {
            method: "POST",
            headers: { "Content-Type":"application/json", Authorization: `Bearer ${this.config.apiKey}` },
            body: JSON.stringify({ model: this.config.model, messages, temperature: this.config.temperature, max_tokens: this.config.maxTokens })
          });
          if (!res.ok) throw new Error("Falha ao obter resposta");
          const data = await res.json();
          const bot = data.choices?.[0]?.message?.content?.trim();
          if (!bot) throw new Error("Resposta vazia");
          this.DOM.chatbox.removeChild(this.DOM.typingIndicator);
          this.addMessage(bot, "bot");
          this.conversations[this.currentConversationId].push({ role: "bot", content: bot });
          this.saveConversations();
        } catch (e) {
          this.DOM.chatbox.removeChild(this.DOM.typingIndicator);
          this.addMessage("Erro: " + e.message, "error");
          this.conversations[this.currentConversationId].push({ role: "error", content: e.message });
          this.saveConversations();
        } finally {
          this.DOM.sendBtn.disabled = false;
          this.DOM.userInput.value = "";
          this.DOM.userInput.focus();
          this.renderConversationsList();
        }
      },
      getSystemPrompt(lang) {
        return { en: "You are a helpful assistant.", es: "Eres un asistente √∫til.", zh: "‰Ω†ÊòØ‰∏Ä‰∏™ÊúâÂ∏ÆÂä©ÁöÑÂä©Êâã„ÄÇ",
                 hi: "‡§Ü‡§™ ‡§è‡§ï ‡§∏‡§π‡§æ‡§Ø‡§ï ‡§∏‡§π‡§æ‡§Ø‡§ï ‡§π‡•à‡§Ç‡•§", ar: "ÿ£ŸÜÿ™ ŸÖÿ≥ÿßÿπÿØ ŸÖŸÅŸäÿØ.", fr: "Vous √™tes un assistant utile.",
                 ru: "–í—ã –ø–æ–ª–µ–∑–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫.", pt: "Voc√™ √© um assistente √∫til."
               }[lang] || "Voc√™ √© um assistente √∫til.";
      }
    };
    window.addEventListener("DOMContentLoaded", () => ViBot.init());
  </script>
</body>
</html>
