<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ViBot Plus</title>
<style>
  :root {
    --primary: #4f46e5;
    --user-bg: #4f46e5;
    --bot-bg: #f3f4f6;
    --error-bg: #fee2e2;
    --text: #111827;
    --error-text: #dc2626;
    --bg: #f9fafb;
    --copy-bg: #e5e7eb;
  }
  [data-theme="dark"] {
    --primary: #6366f1;
    --bg: #1f2937;
    --bot-bg: #374151;
    --text: #f9fafb;
    --user-bg: #6366f1;
    --copy-bg: #4b5563;
  }
  body {
    font-family: 'Inter', sans-serif;
    background: var(--bg);
    color: var(--text);
    margin: 0; padding: 0;
    transition: background 0.3s, color 0.3s;
  }
  header {
    display: flex; justify-content: space-between; align-items: center;
    padding: 16px 32px; background: white; border-bottom: 1px solid #e5e7eb;
  }
  [data-theme="dark"] header { background: #111827; border-color: #374151; }
  h1 { margin: 0; color: var(--primary); }
  header div { display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }
  button, select {
    font-size: 14px; padding: 8px;
    border-radius: 8px; border: 1px solid #d1d5db;
    background: white; cursor: pointer;
  }
  [data-theme="dark"] button, [data-theme="dark"] select {
    background: #1f2937; color: white; border-color: #4b5563;
  }
  button:hover { opacity: 0.9; }
  main { display: flex; max-width: 1100px; margin: 20px auto; gap: 20px; padding: 0 20px; }
  #chat-container { flex: 1; display: flex; flex-direction: column; }
  #chatbox {
    background: white; border: 1px solid #e5e7eb; border-radius: 12px;
    flex: 1; padding: 16px; overflow-y: auto;
    display: flex; flex-direction: column; gap: 12px;
    min-height: 400px;
  }
  [data-theme="dark"] #chatbox {
    background: #111827; border-color: #374151;
  }
  .message {
    padding: 12px 16px; border-radius: 12px; max-width: 85%;
    line-height: 1.5; animation: fadeIn 0.3s ease-out;
    word-wrap: break-word; white-space: pre-wrap;
    position: relative;
  }
  .user { background: var(--user-bg); color: white; align-self: flex-end; border-bottom-right-radius: 4px; }
  .bot { background: var(--bot-bg); color: var(--text); align-self: flex-start; border-bottom-left-radius: 4px; }
  .error { background: var(--error-bg); color: var(--error-text); align-self: center; text-align: center; }
  .typing { color: #6b7280; font-style: italic; animation: blink 1s steps(1) infinite; }
  @keyframes fadeIn { from {opacity:0;transform:translateY(10px);} to {opacity:1;transform:translateY(0);} }
  @keyframes blink { 50% {opacity:0.5;} }
  #input-container { display: flex; gap: 12px; margin-top: 12px; }
  #userInput {
    flex: 1; padding: 12px 16px; border: 1px solid #e5e7eb;
    border-radius: 12px; font-size: 16px; background: white;
  }
  [data-theme="dark"] #userInput {
    background: #1f2937; color: white; border-color: #4b5563;
  }
  #sendBtn {
    background: var(--primary); color: white; border: none;
    border-radius: 12px; padding: 0 24px; font-weight: 500;
    cursor: pointer; transition: background-color 0.2s;
  }
  #sendBtn:hover { background: #4338ca; }
  #sendBtn:disabled { background: #9ca3af; cursor: not-allowed; }
  aside {
    width: 250px; background: white; border: 1px solid #e5e7eb;
    border-radius: 12px; padding: 16px; display: flex;
    flex-direction: column; gap: 12px;
  }
  [data-theme="dark"] aside { background: #111827; border-color: #374151; }
  #newConversationBtn {
    background: var(--primary); color: white; border: none;
    border-radius: 12px; padding: 12px; font-weight: 600;
    cursor: pointer; transition: background-color 0.2s;
  }
  #newConversationBtn:hover { background: #4338ca; }
  #conversationList {
    overflow-y: auto; flex: 1;
    display: flex; flex-direction: column; gap: 8px;
  }
  .conversation-btn {
    background: #f3f4f6; border: none; border-radius: 8px;
    padding: 8px 12px; font-size: 14px; color: var(--text);
    text-align: left; white-space: nowrap; overflow: hidden;
    text-overflow: ellipsis; cursor: pointer;
    transition: background-color 0.2s;
    position: relative;
  }
  [data-theme="dark"] .conversation-btn { background: #374151; }
  .conversation-btn:hover { background: var(--primary); color: white; }
  .conversation-btn.active { background: var(--primary); color: white; font-weight: 700; }
  .conversation-actions {
    position: absolute; right: 8px; top: 50%;
    transform: translateY(-50%); display: flex; gap: 4px;
  }
  .conversation-btn:hover .conversation-actions { display: flex; }
  .message-actions {
    display: flex; justify-content: flex-end; margin-top: 8px; gap: 8px;
  }
  .action-btn {
    background: var(--copy-bg); border: none;
    border-radius: 4px; padding: 4px 8px; font-size: 12px;
    cursor: pointer; transition: background-color 0.2s;
    display: flex; align-items: center; gap: 4px;
  }
  .user .action-btn { background: rgba(255,255,255,0.2); }
  [data-theme="dark"] .action-btn { background: rgba(255,255,255,0.1); }
  [data-theme="dark"] .user .action-btn { background: rgba(0,0,0,0.2); }
  .action-btn:hover { background: rgba(0,0,0,0.2); }
  .user .action-btn:hover { background: rgba(255,255,255,0.3); }
  .model-selector { margin-top: 12px; width: 100%; }
  .settings-panel { margin-top: 12px; padding: 12px; background: var(--bot-bg); border-radius: 8px; }
  .settings-title { font-weight: bold; margin-bottom: 8px; }
  .slider-container { margin: 12px 0; }
  .slider-label { display: flex; justify-content: space-between; margin-bottom: 4px; }
  .slider-value { font-weight: bold; }
  input[type="range"] { width: 100%; }
  .token-count { font-size: 12px; color: #6b7280; text-align: right; margin-top: 4px; }
  [data-theme="dark"] .token-count { color: #9ca3af; }
  .system-prompt-container { margin-top: 12px; }
  #systemPrompt {
    width: 100%; padding: 8px; border-radius: 8px;
    border: 1px solid #d1d5db; background: white;
    font-family: inherit; resize: vertical; min-height: 60px;
  }
  [data-theme="dark"] #systemPrompt {
    background: #1f2937; color: white; border-color: #4b5563;
  }
  @media(max-width:768px){
    main{flex-direction:column;}
    aside{width:100%;margin-bottom:20px;order:-1;}
    #chatbox{height:50vh;}
    #input-container{flex-direction:column;}
    #sendBtn{width:100%;}
    .conversation-actions{display:flex;}
    header div{gap:4px;}
    button,select{padding:6px;font-size:12px;}
  }
</style>
</head>
<body>
<header>
  <h1>ViBot Plus</h1>
  <div>
    <button id="toggleTheme">üåì Tema</button>
    <button id="exportHistory">üìÇ Exportar</button>
    <button id="importHistory">üìÅ Importar</button>
    <button id="settingsBtn">‚öôÔ∏è Config</button>
  </div>
</header>
<main>
  <div id="chat-container">
    <div id="chatbox" role="log" aria-live="polite" aria-atomic="false"></div>
    <div id="input-container">
      <input id="userInput" placeholder="Digite sua mensagem..." autocomplete="off" />
      <button id="sendBtn">üì© Enviar</button>
    </div>
  </div>
  <aside>
    <button id="newConversationBtn">‚ûï Nova Conversa</button>
    <div id="conversationList"></div>
    <div class="settings-panel" id="settingsPanel" style="display:none;">
      <div class="settings-title">Configura√ß√µes do Modelo</div>
      <select id="modelSelector" class="model-selector">
        <option value="llama3-70b-8192">ViBot Pro</option>
        <option value="llama3-8b-8192">ViBot Standard</option>
        <option value="mixtral-8x7b-32768">ViBot Expert</option>
        <option value="gemma-7b-it">ViBot Lite</option>
      </select>
      <div class="slider-container">
        <div class="slider-label"><span>Criatividade</span><span id="temperatureValue">0.7</span></div>
        <input type="range" id="temperatureSlider" min="0" max="2" step="0.1" value="0.7"/>
      </div>
      <div class="slider-container">
        <div class="slider-label"><span>Resposta M√°xima</span><span id="maxTokensValue">1024</span></div>
        <input type="range" id="maxTokensSlider" min="256" max="4096" step="128" value="1024"/>
        <div class="token-count" id="tokenCount">Tokens usados: 0</div>
      </div>
      <div class="system-prompt-container">
        <div class="settings-title">Prompt do Sistema</div>
        <textarea id="systemPrompt" placeholder="Como o assistente deve se comportar..."></textarea>
      </div>
    </div>
  </aside>
</main>
<input type="file" id="importFile" accept=".json,.txt" style="display:none;"/>
<script>
const ViBot = {
  config: {
    apiUrl: "https://api.groq.com/openai/v1/chat/completions",
    apiKey: "gsk_GAB1Wl5zqbp30qPDeMObWGdyb3FY0g7KiTlGt5aWhUnkD495Bi3T",
    model: "llama3-70b-8192",
    temperature: 0.7,
    maxTokens: 1024,
    systemPrompt: "Voc√™ √© um assistente √∫til chamado ViBot. Responda de forma clara e concisa no idioma do usu√°rio."
  },
  modelNames: {
    "llama3-70b-8192":"ViBot Pro","llama3-8b-8192":"ViBot Standard","mixtral-8x7b-32768":"ViBot Expert","gemma-7b-it":"ViBot Lite"
  },
  getModelIdByName(name){return Object.entries(this.modelNames).find(([,v])=>v===name)?.[0]||"llama3-70b-8192";},
  callGroq: async function(prompt){
    try {
      const resp = await fetch(this.config.apiUrl, {
        method:"POST",
        headers:{
          "Content-Type":"application/json",
          Authorization:`Bearer ${this.config.apiKey}`
        },
        body:JSON.stringify({
          model:this.config.model,
          messages:[
            {role:"system",content:this.config.systemPrompt},
            {role:"user",content:prompt}
          ],
          temperature:this.config.temperature,
          max_tokens:this.config.maxTokens
        })
      });
      const data = await resp.json();
      return data.choices[0].message.content.trim();
    } catch(e){console.error(e); return "‚ùå Erro na chamada Groq.";}
  },
  summarizeText: async function(text){return await this.callGroq(`Resuma o seguinte texto:\n\n${text}`);},
  explainCode: async function(code){return await this.callGroq(`Explique este c√≥digo:\n\n${code}`);},
  correctText: async function(text){return await this.callGroq(`Corrija o texto:\n\n${text}`);},
  translate: async function(text,lang="ingl√™s"){return await this.callGroq(`Traduza para ${lang}:\n\n${text}`);},
  generateEmail: async function(ctx){return await this.callGroq(`Escreva e‚Äëmail formal:\n\n${ctx}`);},
  generateTitle: async function(content){return await this.callGroq(`Crie t√≠tulo:\n\n${content}`);},
  rewrite: async function(text,tone="profissional"){return await this.callGroq(`Reescreva com tom ${tone}:\n\n${text}`);},
  brainstormIdeas: async function(topic){return await this.callGroq(`Ideias criativas para:\n\n${topic}`);},
  generateSupportReply: async function(msg){return await this.callGroq(`Resposta √∫til para cliente:\n\n${msg}`);},
  explainConcept: async function(c){return await this.callGroq(`Explique o conceito:\n\n${c}`);},
  generateChecklist: async function(goal){return await this.callGroq(`Checklist para:\n\n${goal}`);},
  meetingSummary: async function(trans){return await this.callGroq(`Resuma ata reuni√£o:\n\n${trans}`);},
  studyPlan: async function(subject,duration){return await this.callGroq(`Plano de estudo ${subject} por ${duration}`);},
  professionalBio: async function(details){return await this.callGroq(`Biografia profissional:\n\n${details}`);},
  productNames: async function(desc){return await this.callGroq(`Nomes para produto:\n\n${desc}`);},
  miniLesson: async function(topic){return await this.callGroq(`Mini aula: ${topic}`);},
  generateStory: async function(prompt){return await this.callGroq(`Conte hist√≥ria baseada em:\n\n${prompt}`);},
  simpleDiagnosis: async function(symptoms){return await this.callGroq(`Hip√≥tese m√©dica (n√£o profissional):\n\n${symptoms}`);},
  extractTopics: async function(text){return await this.callGroq(`T√≥picos principais:\n\n${text}`);},
  generateSlogan: async function(info){return await this.callGroq(`Crie slogans:\n\n${info}`);},

  init(){
    this.chatbox=document.getElementById("chatbox");
    this.userInput=document.getElementById("userInput");
    this.sendBtn=document.getElementById("sendBtn");
    this.newConversationBtn=document.getElementById("newConversationBtn");
    this.conversationList=document.getElementById("conversationList");
    this.toggleThemeBtn=document.getElementById("toggleTheme");
    this.exportHistoryBtn=document.getElementById("exportHistory");
    this.importHistoryBtn=document.getElementById("importHistory");
    this.importFileInput=document.getElementById("importFile");
    this.settingsBtn=document.getElementById("settingsBtn");
    this.settingsPanel=document.getElementById("settingsPanel");
    this.modelSelector=document.getElementById("modelSelector");
    this.temperatureSlider=document.getElementById("temperatureSlider");
    this.temperatureValue=document.getElementById("temperatureValue");
    this.maxTokensSlider=document.getElementById("maxTokensSlider");
    this.maxTokensValue=document.getElementById("maxTokensValue");
    this.tokenCount=document.getElementById("tokenCount");
    this.systemPrompt=document.getElementById("systemPrompt");
    this.conversations={}; this.currentConversationId=null; this.totalTokens=0;
    this.typingIndicator=document.createElement("div");
    this.typingIndicator.className="message bot typing";
    this.typingIndicator.textContent="ViBot est√° digitando...";
    this.loadTheme(); this.loadSettings(); this.loadConversations();
    if(!this.currentConversationId||!this.conversations[this.currentConversationId]) this.createNewConversation();
    else {this.renderConversationsList();this.renderCurrentConversation();}
    this.sendBtn.onclick=()=>this.sendMessage();
    this.userInput.addEventListener("keydown",e=>{ if(e.key==="Enter"&&!e.shiftKey){e.preventDefault(); this.sendMessage();}});
    this.newConversationBtn.onclick=()=>this.createNewConversation();
    this.toggleThemeBtn.onclick=()=>this.toggleTheme();
    this.exportHistoryBtn.onclick=()=>this.exportHistory();
    this.importHistoryBtn.onclick=()=>this.importFileInput.click();
    this.importFileInput.onchange=e=>this.importHistory(e);
    this.settingsBtn.onclick=()=>this.toggleSettings();
    this.modelSelector.onchange=e=>this.updateModel(this.getModelIdByName(e.target.value));
    this.temperatureSlider.oninput=e=>this.updateTemperature(e.target.value);
    this.maxTokensSlider.oninput=e=>this.updateMaxTokens(e.target.value);
    this.systemPrompt.onchange=()=>this.saveSettings();
    this.userInput.focus();
  },
  loadTheme(){const t=localStorage.getItem("vibot_theme")||"light"; document.documentElement.setAttribute("data-theme",t);},
  toggleTheme(){const c=document.documentElement.getAttribute("data-theme"); const n=c==="dark"?"light":"dark"; document.documentElement.setAttribute("data-theme",n); localStorage.setItem("vibot_theme",n);},
  loadSettings(){ const s=JSON.parse(localStorage.getItem("vibot_settings"))||{};
    if(s.model){this.config.model=s.model; this.modelSelector.value=this.modelNames[s.model];}
    if(s.temperature){this.config.temperature=parseFloat(s.temperature); this.temperatureSlider.value=this.config.temperature; this.temperatureValue.textContent=this.config.temperature;}
    if(s.maxTokens){this.config.maxTokens=parseInt(s.maxTokens); this.maxTokensSlider.value=this.config.maxTokens; this.maxTokensValue.textContent=this.config.maxTokens;}
    if(s.systemPrompt){this.config.systemPrompt=s.systemPrompt; this.systemPrompt.value=this.config.systemPrompt;}
  },
  saveSettings(){ 
    const s={
      model: this.config.model,
      temperature: this.config.temperature,
      maxTokens: this.config.maxTokens,
      systemPrompt: this.systemPrompt.value
    }; 
    localStorage.setItem("vibot_settings", JSON.stringify(s)); 
    this.config.systemPrompt = this.systemPrompt.value;
  },
  updateModel(m){ this.config.model=m; this.saveSettings(); },
  updateTemperature(v){ this.config.temperature=parseFloat(v); this.temperatureValue.textContent=v; this.saveSettings(); },
  updateMaxTokens(v){ this.config.maxTokens=parseInt(v); this.maxTokensValue.textContent=v; this.saveSettings(); },
  toggleSettings(){ 
    this.settingsPanel.style.display = this.settingsPanel.style.display === "none" ? "block" : "none";
  },
  loadConversations(){ const s=localStorage.getItem("vibot_conversations"); try { if(s) this.conversations=JSON.parse(s); this.currentConversationId=localStorage.getItem("vibot_currentConversation"); } catch { this.conversations={}; } },
  saveConversations(){ localStorage.setItem("vibot_conversations",JSON.stringify(this.conversations)); localStorage.setItem("vibot_currentConversation",this.currentConversationId); },
  createNewConversation(){ const id="conv_"+Date.now(); this.conversations[id]={id, title:"Nova Conversa", messages:[], createdAt:Date.now()}; this.currentConversationId=id; this.saveConversations(); this.renderConversationsList(); this.renderCurrentConversation(); this.userInput.focus(); },
  renderConversationsList(){ this.conversationList.innerHTML=""; Object.values(this.conversations).sort((a,b)=>b.createdAt-a.createdAt).forEach(c=>{ const btn=document.createElement("button"); btn.className=`conversation-btn ${c.id===this.currentConversationId?"active":""}`; btn.textContent=c.title; btn.onclick=()=>this.switchConversation(c.id);
    const actions=document.createElement("div"); actions.className="conversation-actions";
    const del=document.createElement("button"); del.className="action-btn"; del.innerHTML="üóëÔ∏è"; del.onclick=e=>{e.stopPropagation(); this.deleteConversation(c.id);};
    actions.appendChild(del); btn.appendChild(actions); this.conversationList.appendChild(btn);
  }); },
  switchConversation(id){this.currentConversationId=id; this.saveConversations(); this.renderConversationsList(); this.renderCurrentConversation();},
  deleteConversation(id){ if(Object.keys(this.conversations).length<=1){this.createNewConversation();}
    delete this.conversations[id]; this.saveConversations(); if(id===this.currentConversationId){const first=Object.keys(this.conversations)[0]; this.switchConversation(first);} else this.renderConversationsList();
  },
  renderCurrentConversation(){ this.chatbox.innerHTML=""; const conv=this.conversations[this.currentConversationId]; if(conv.messages.length===0){this.addMessage("bot","Ol√°! Sou o ViBot, seu assistente de IA. Como posso te ajudar hoje?");} else conv.messages.forEach(m=>this.addMessageToChatbox(m.role,m.content,m.type)); this.chatbox.scrollTop=this.chatbox.scrollHeight; },
  async sendMessage(){ const msg=this.userInput.value.trim(); if(!msg)return; const conv=this.conversations[this.currentConversationId]; this.addMessage("user",msg); this.userInput.value=""; this.chatbox.appendChild(this.typingIndicator); this.chatbox.scrollTop=this.chatbox.scrollHeight;
    try {
      const msgs=[ {role:"system",content:this.config.systemPrompt}, ...conv.messages.map(m=>({role:m.role,content:this.getTextContent(m.content)})) ];
      const resp=await fetch(this.config.apiUrl,{method:"POST",headers:{"Content-Type":"application/json","Authorization":`Bearer ${this.config.apiKey}`},body:JSON.stringify({model:this.config.model,messages:msgs,temperature:this.config.temperature,max_tokens:this.config.maxTokens})});
      if(!resp.ok)throw new Error( resp.status );
      const data=await resp.json(); const bot=data.choices[0].message.content;
      this.typingIndicator.remove(); this.addMessage("bot",bot);
      this.totalTokens+=data.usage.total_tokens; this.tokenCount.textContent=`Tokens usados: ${this.totalTokens}`;
    } catch(err){ this.typingIndicator.remove(); this.addMessage("bot",`Desculpe, ocorreu um erro: ${err.message}`,"error"); console.error(err); }
  },
  addMessage(role,content,type=null){ const conv=this.conversations[this.currentConversationId]; const m={role,content,type,timestamp:Date.now()}; conv.messages.push(m); if(role==="user"&&conv.messages.length===1){ conv.title=content.length>30?content.slice(0,30)+"...":content; } this.saveConversations(); this.renderConversationsList(); this.addMessageToChatbox(role,content,type); this.chatbox.scrollTop=this.chatbox.scrollHeight; },
  addMessageToChatbox(role,content){ const div=document.createElement("div"); div.className=`message ${role}`; div.innerHTML=content; const actions=document.createElement("div"); actions.className="message-actions"; const copy=document.createElement("button"); copy.className="action-btn"; copy.innerHTML="üìã Copiar"; copy.onclick=()=>{navigator.clipboard.writeText(this.getTextContent(content));copy.innerHTML="‚úì Copiado!";setTimeout(()=>copy.innerHTML="üìã Copiar",2000);}; actions.appendChild(copy); div.appendChild(actions); this.chatbox.appendChild(div); },
  getTextContent(html){ const t=document.createElement("div"); t.innerHTML=html; return t.textContent||t.innerText||""; },
  exportHistory(){ const data={conversations:this.conversations, currentConversationId:this.currentConversationId, settings:{model:this.config.model,temperature:this.config.temperature,maxTokens:this.config.maxTokens,systemPrompt:this.config.systemPrompt}}; const blob=new Blob([JSON.stringify(data,null,2)],{type:"application/json"}); const url=URL.createObjectURL(blob); const a=document.createElement("a"); a.href=url; a.download=`vibot-history-${new Date().toISOString().slice(0,10)}.json`; a.click(); setTimeout(()=>URL.revokeObjectURL(url),100); },
  importHistory(e){ const file=e.target.files[0]; if(!file)return; const r=new FileReader(); r.onload=ev=>{ try{ const data=JSON.parse(ev.target.result); if(data.conversations)this.conversations=data.conversations; if(data.currentConversationId)this.currentConversationId=data.currentConversationId; if(data.settings){ if(data.settings.model)this.config.model=data.settings.model; if(data.settings.temperature)this.config.temperature=data.settings.temperature; if(data.settings.maxTokens)this.config.maxTokens=data.settings.maxTokens; if(data.settings.systemPrompt)this.config.systemPrompt=data.settings.systemPrompt; this.saveSettings(); } this.saveConversations(); this.renderConversationsList(); this.renderCurrentConversation(); this.addMessage("bot","Hist√≥rico importado com sucesso!"); }catch(err){ this.addMessage("bot","Erro ao importar hist√≥rico.","error"); console.error(err);} }; r.readAsText(file); },
};
window.onload = () => ViBot.init();
</script>
</body>
</html>
